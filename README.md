# Cloudflare 优选IP提取器

一个功能强大的Python工具，用于从指定数据源自动下载并提取优质的Cloudflare节点IP地址。本工具支持多种运营商线路筛选，并提供JSON格式的标准化输出，满足各类网络优化和域名解析需求。

## 项目简介

Cloudflare作为全球领先的CDN服务商，免费提供不限流量的CC防护、DDoS防护和CDN加速服务。然而，由于其全球分布的节点特性，部分IP地址在国内访问时可能出现延迟较高或连接不稳定的问题。本工具通过自动化方式从权威数据源获取经过测试筛选的优质节点IP，帮助用户快速定位和选择最适合自身网络环境的Cloudflare节点。

本提取器从麒麟域名检测平台获取数据，该平台在全国部署了多个测试节点，每10分钟自动更新一次IP池，确保所提供的IP地址具有较高的稳定性和访问速度。提取结果涵盖电信、联通、移动、多线和IPv6五种线路类型，用户可根据自身网络环境选择最优节点。

## 功能特性

本工具具备以下核心功能，为用户提供便捷高效的IP提取体验：

**多线路智能筛选**：支持电信、联通、移动、多线、IPv6五种网络线路的独立筛选，用户可根据自身网络环境精准选择最优节点。系统内置智能识别算法，能够准确区分不同运营商的IP地址，避免混淆和误选。

**自动化数据提取**：完全自动化的HTML解析和数据提取流程，无需人工干预即可完成从网页下载到数据结构化输出的全部操作。脚本采用模块化设计，各功能组件职责清晰，便于维护和扩展。

**标准化JSON输出**：提取结果以标准JSON格式输出，包含运营商类型（isp）和IP地址（ip）两个字段，便于程序化处理和二次开发。JSON输出支持中文字符，确保信息可读性。

**详细执行日志**：运行过程中实时输出下载进度、提取统计和结果摘要，帮助用户了解执行状态和数据分布情况。日志信息包含各线路的IP数量统计，便于快速评估数据完整性。

**持久化存储**：自动将提取结果保存至本地JSON文件，文件名默认为`cloudflare_ips.json`，方便后续查阅和程序调用。文件编码采用UTF-8标准，兼容各类文本编辑器和处理工具。

## 环境要求

在运行本工具之前，请确保您的系统满足以下环境要求：

Python版本方面，建议使用Python 3.6或更高版本。Python 3.6及以上版本原生支持f-string格式化字符串和字典序遍历等特性，能够保证脚本的正常运行。如果您的系统中Python版本较低，建议升级至最新稳定版本以获得最佳兼容性和性能表现。

网络环境方面，需要确保能够正常访问目标数据源URL（`https://api.uouin.com/cloudflare.html`）。由于目标站点可能存在网络波动或临时不可用情况，建议在网络稳定的环境下运行脚本，或实现适当的重试机制以提高提取成功率。

依赖库方面，本工具仅依赖Python标准库和BeautifulSoup4一个外部包。标准库包含`json`、`sys`、`urllib`等模块，无需额外安装。BeautifulSoup4用于HTML解析，功能强大且稳定可靠。

## 安装指南

按照以下步骤完成工具的安装和配置：

第一步，创建项目目录并进入该目录。您可以在任意位置创建文件夹，用于存放本工具的相关文件。建议目录名称为`cloudflare-ip-extractor`，以明确项目用途。

第二步，安装依赖包。使用pip命令安装BeautifulSoup4库，这是唯一的外部依赖。执行命令`pip install beautifulsoup4`即可完成安装，安装过程中pip会自动处理依赖关系。如果您的环境中同时存在Python 2和Python 3，建议使用`pip3 install beautifulsoup4`以确保安装到正确的Python版本。

第三步，下载或复制本工具的Python脚本文件。创建一个名为`cloudflare_ip_extractor.py`的文件，将代码内容完整复制进去。代码文件应与`requirements.txt`文件位于同一目录下，以便于管理和执行。

第四步，验证安装结果。打开终端或命令行窗口，切换到项目目录，执行`python cloudflare_ip_extractor.py`命令。如果环境配置正确，您将看到脚本开始下载数据并输出提取结果。

## 使用方法

### 基础用法

最简单的方式是直接运行脚本，无需任何参数。脚本将使用默认配置从数据源下载最新数据并提取所有可用的IP地址。执行命令后，请观察终端输出，等待下载和解析过程完成。

### 运行示例

以下是脚本的标准运行流程和预期输出：

```
正在下载: https://api.uouin.com/cloudflare.html
```

下载成功后，脚本将自动解析HTML页面并提取IP信息。提取完成后，终端将显示详细的统计信息：

```
=== 提取结果 ===
总计: 50 个IP
  电信: 10个
  联通: 10个
  移动: 10个
  多线: 10个
  IPV6: 10个
```

随后，脚本将输出完整的JSON数据并保存至文件：

```
=== JSON输出 ===
[
  {
    "isp": "电信",
    "ip": "172.64.82.114"
  },
  ...
]

已保存到: cloudflare_ips.json
```

### 输出文件说明

脚本运行完成后，将在当前目录生成`cloudflare_ips.json`文件。该文件采用UTF-8编码，可以使用任意文本编辑器打开查看。文件内容为JSON数组格式，每个元素包含两个字段：`isp`表示运营商线路类型，`ip`表示IP地址。

以下是文件的结构说明和示例：

| 字段 | 类型 | 说明 |
|------|------|------|
| isp | 字符串 | 运营商线路类型，支持电信、联通、移动、多线、IPV6 |
| ip | 字符串 | IPv4或IPv6格式的节点IP地址 |

对于IPv6地址，脚本会完整保留地址格式，包括所有冒号分隔的十六进制段。IPv4地址则采用标准的点分十进制表示法。

## 线路说明

为了帮助用户更好地理解各线路类型的特点和应用场景，以下进行详细说明：

**电信线路**适用于中国电信宽带用户，选择电信线路的节点可以获得更低的访问延迟和更稳定的连接质量。示例IP如`172.64.82.114`等，经过测试电信用户的平均延迟在130-140毫秒左右。

**联通线路**适用于中国联通宽带用户，联通节点在国内北方地区通常具有较好的访问速度。示例IP如`104.26.4.90`等，测试延迟普遍在60-70毫秒范围内，相比电信线路有明显优势。

**移动线路**适用于中国移动宽带用户，特别是手机移动网络环境。示例IP如`104.18.81.19`等，移动节点在南方地区的表现通常优于电信和联通。

**多线线路**适用于多网络环境或混合带宽场景，这类节点对多家运营商用户均有较好的兼容性。示例IP如`104.18.255.167`等，适合作为备用节点或需要同时服务多种网络用户的情况。

**IPv6线路**专门为IPv6网络环境设计，适用于已部署IPv6的家庭宽带或数据中心环境。示例地址如`2a06:98c1:3121:c6d4:4130:7992:df42:f04c`等，IPv6节点可以作为IPv4节点的补充方案。

## 进阶应用

### 程序化调用

本工具的核心函数设计为模块化结构，支持在其他Python程序中导入调用。如果您需要将IP提取功能集成到更大的项目中，可以参考以下代码模式：

```python
import json
from cloudflare_ip_extractor import download_html, extract_ips

# 自定义URL提取
def get_ips_from_url(url):
    html = download_html(url)
    results = extract_ips(html)
    return results

# 筛选特定线路
def filter_ips_by_isp(ips, isp_list):
    return [item for item in ips if item['isp'] in isp_list]

# 按线路分组
def group_ips_by_isp(ips):
    grouped = {}
    for item in ips:
        isp = item['isp']
        if isp not in grouped:
            grouped[isp] = []
        grouped[isp].append(item['ip'])
    return grouped
```

### 定时任务配置

对于需要定期更新IP池的场景，可以将脚本配置为系统定时任务。在Linux系统中，可以使用cron服务实现；在Windows系统中，可以使用任务计划程序。以下是Linux系统下的配置示例：

首先，使用`crontab -e`命令编辑crontab文件。然后，添加定时任务行，例如每天凌晨2点执行：

```
0 2 * * * /usr/bin/python3 /path/to/cloudflare_ip_extractor.py >> /var/log/cloudflare_ip.log 2>&1
```

此配置将每天凌晨2点自动执行脚本，并将输出追加到日志文件中。您可以根据实际需求调整执行频率和日志文件路径。

### 批量处理扩展

当需要从多个数据源提取IP时，可以扩展脚本实现批量处理。以下是简单的批量处理框架示例：

```python
import concurrent.futures
from cloudflare_ip_extractor import download_html, extract_ips

urls = [
    "https://api.uouin.com/cloudflare.html",
    # 添加其他数据源URL
]

def process_url(url):
    html = download_html(url)
    return extract_ips(html)

with concurrent.futures.ThreadPoolExecutor() as executor:
    results = list(executor.map(process_url, urls))
```

使用线程池可以并行处理多个数据源，显著提高大规模数据提取的效率。

## 故障排查

在使用本工具过程中可能遇到的问题及解决方法：

**下载失败**通常由网络连接问题或目标站点不可用引起。首先检查本地网络连接是否正常，可以尝试使用浏览器直接访问数据源URL确认站点状态。如果网络正常但脚本仍无法下载，可能是目标站点临时维护或更改了访问策略，此时建议稍后重试。

**解析错误**可能由于目标网页结构发生变化导致。HTML解析依赖于页面中的表格结构，如果网站更新了页面模板，现有的解析逻辑可能需要相应调整。建议定期检查输出结果，如果发现提取的数据格式异常或数量明显减少，可能是页面结构已变更，需要更新解析代码。

**依赖缺失**问题通常发生在新环境首次运行时。确保已正确安装BeautifulSoup4库，可以使用`pip show beautifulsoup4`命令验证安装状态。如果提示未安装，请重新执行安装命令。

**编码问题**可能导致输出内容显示乱码。本脚本已显式指定UTF-8编码处理HTML内容和文件输出，如果仍出现乱码，请检查终端或编辑器的字符编码设置是否支持UTF-8。

## 数据来源

本工具的数据来源于麒麟域名检测平台（api.uouin.com），该平台提供以下服务特性：

数据更新频率方面，IP池每10分钟自动更新一次，确保用户获取的IP地址具有时效性和可用性。测试节点分布在全国多个地区，能够较全面地反映国内用户的实际访问体验。

测试指标方面，平台对每个节点进行丢包率、延迟、速度和带宽四项核心指标测试。这些指标可以帮助用户判断节点的质量等级，选择最优的接入点。

数据格式方面，页面采用HTML表格形式展示测试结果，包含序号、线路、优选IP、丢包率、延迟、速度、带宽、数据中心和测试时间等字段。本工具提取其中线路和优选IP两个核心字段。

## 注意事项

在使用本工具时，请注意以下事项：

数据时效性方面，获取的IP地址数据具有时效性，建议根据实际使用场景定期更新。虽然Cloudflare节点相对稳定，但个别IP可能因各种原因失效，建议在使用前进行可用性验证。

合规使用方面，本工具仅用于获取和分析公开的IP地址信息，请确保使用行为符合相关法律法规和平台服务条款。获取的IP地址应用于合法的网络优化和加速目的，不得用于任何违法违规活动。

网络环境影响方面，实际访问延迟和稳定性受用户自身网络环境、运营商策略、国际出口带宽等多种因素影响，测试数据仅供参考。建议在正式部署前进行实际测试验证。

## 依赖说明

本工具的正常运行依赖以下软件包：

| 依赖包 | 版本要求 | 说明 |
|--------|----------|------|
| Python | >= 3.6 | 运行时环境 |
| beautifulsoup4 | 任意稳定版本 | HTML解析库 |

安装命令：`pip install beautifulsoup4`

## 版本历史

**v1.0.0**（初始版本）实现基础的HTML下载和IP提取功能，支持电信、联通、移动、多线、IPv6五种线路的识别和筛选，输出标准化JSON格式数据。

## 贡献指南

如果您希望为本项目贡献代码或改进建议，欢迎通过以下方式进行：

代码改进方面，如果您优化了解析算法、添加了新功能或修复了已知问题，欢迎提交Pull Request。请确保代码风格与现有项目保持一致，并添加适当的注释说明。

文档完善方面，如果发现文档描述不准确或存在遗漏，欢迎提出Issue或直接编辑文档内容。

问题反馈方面，如果在使用过程中遇到问题，请在Issue中详细描述错误现象、运行环境和建议的解决方案，以便快速定位和解决问题。

## 许可证

本项目采用MIT许可证开源，您可以自由使用、修改和分发本软件的源代码，但需要保留原始版权声明和许可证文本。关于MIT许可证的详细内容，请参阅项目中的LICENSE文件或访问Open Source Initiative官网查询。

## 联系方式

如有任何问题或建议，欢迎通过以下方式联系：

项目地址：https://github.com/yourusername/cloudflare-ip-extractor（请替换为实际项目地址）

维护者：MiniMax Agent

最后更新：2025年12月
